<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>John Chandler Burnham - Notes (TLPH 11/15): Extensible Data</title>
        <link rel="stylesheet" type="text/css" href="../../../css/default.css" />
    </head>
    <body>
        <div id="header">
            <div id="navigation">
                <a href="../../../">posts</a>
                <a href="../../../about.html">about</a>
                <a href="../../../projects.html">projects</a>
                <a href="https://github.com/johnchandlerburnham">github</a>
                <a href="https://fosstodon.org/@johnburnham">fediverse</a>
            </div>
        </div>
        <div id="content">
            <h1>Notes (TLPH 11/15): Extensible Data</h1>
          <h1 id="open-sums">11.2 Open Sums</h1>
<h2 id="exercise-11.2-i">Exercise 11.2 (i)</h2>
<p>So this seems pretty straighforward, all you need for <code>weaken</code> is to add a component of the sum at the type level, but the value level remains the same. Ergo, <code>unsafeCoerce</code>.</p>
<p>On second thought though, this will make the indices inconsistent, so maybe we should do</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="ot">weaken ::</span> <span class="dt">OpenSum</span> f ts <span class="ot">-&gt;</span> <span class="dt">OpenSum</span> f (x '<span class="op">:</span> ts)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>weaken (<span class="dt">UnsafeOpenSum</span> i f) <span class="ot">=</span> <span class="dt">UnsafeOpenSum</span> (i <span class="op">+</span> <span class="dv">1</span>) f</span></code></pre></div>
<p>instead?</p>
<h1 id="open-products">11.3 Open Products</h1>
<p><code>Key</code> is like <code>Proxy</code> for kind <code>Symbol</code>.</p>
<h2 id="exercise-11.3-ii">Exercise 11.3 (ii)</h2>
<p>What’s interesting here is that we’re using two distinct mechanisms for deleting an element: filtering by key at the type level, and direct index manipulation at the value level.</p>
<p>The problem is that it seems like the consistency of the type level with the value level isn’t checked. If we delete at the type level, but not the value level it looks like it still passses type checking just fine:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="ot">delete ::</span> <span class="kw">forall</span> key ts t f<span class="op">.</span> <span class="dt">KnownNat</span> (<span class="dt">FindElem</span> key ts)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>       <span class="ot">=&gt;</span> <span class="dt">Key</span> key</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>       <span class="ot">-&gt;</span> <span class="dt">OpenProduct</span> f ts</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>       <span class="ot">-&gt;</span> <span class="dt">OpenProduct</span> f (<span class="dt">Eval</span> (<span class="dt">DeleteElem</span> key ts))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>delete _ (<span class="dt">OpenProduct</span> v) <span class="ot">=</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>  <span class="kw">let</span> (a, b) <span class="ot">=</span> V.splitAt (findElem <span class="op">@</span>key <span class="op">@</span>ts) v</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>   <span class="kw">in</span> <span class="dt">OpenProduct</span> <span class="op">$</span> a <span class="op">V.++</span> b</span></code></pre></div>
<h2 id="exercise-11.3-iii">Exercise 11.3 (iii)</h2>
<p>This was a difficult exercise, and I confess I looked at the solution in the back of the book to figure out some of the mechanics, like using classes to lower typelevel naturals and getting around the lack of type-level lambdas.</p>
<p>I think I mostly understand the techniques here, but I think I need some more practice.</p>
<h1 id="overloaded-labels">11.4 Overloaded Labels</h1>
<p>Interestingly, <code>get #key result</code> gives a very long type error for me, whereas <code>get (Key @"key") result</code> works fine.</p>
        </div>
        <div id="footer">
          <p>&copy; <script>document.write(new Date().getFullYear());</script>
             John Chandler Burnham.
            Generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>
          </p>
        </div>
    </body>
</html>
